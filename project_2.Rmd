---
title: "Team 12 - Hot Cocoa Codesters Project 1"
author: "Grace Chang, Seungwan Kim, Riley C Maher, Sage O'Toole, Jenna Kay Probst"
date: "2/21/2021"
output:
  html_document:
    number_sections: True
    toc: True
    toc_float: True
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Project 2

Our objective is to identify arbitrage opportunities. Are there elements that the market does not consider a risk factor - but it actually is? Looking in the opposite direction - are there elements that market considers a risk factor but actually it isn’t.

## Importing Packages

```{r}
library(gmodels)
```
## Importing Data
```{r}
listings <- read.csv('ProjectA_Listings2013.csv', stringsAsFactors = TRUE)
head(listings)
```

## Data Cleaning
```{r}
str(listings)

# Dropping redundant columns and columns with too many character factor levels 
listings = subset(listings, select = -c(borrower_city, borrower_state, loan_status, first_recorded_credit_line, loan_origination_date, occupation))

# Converting logical values to binary 
cols <- sapply(listings, is.logical)
listings[,cols] <- lapply(listings[,cols], as.numeric)
str(listings)
```

```{r}
# summary(listings)
```

## Linear Regression

A linear regression model to determine how interest rate for loans is determined. Essentially, we are getting an idea of what the market considers “credit risks”. We get a sense of how much interest rate premium is demanded by the market for compensating for a specific credit risk.

```{r}
listings_lm <- listings
linear1 <- lm(borrower_rate ~ ., data=listings_lm)
summary(linear1)
# income_range and income_range_description were not significant which is odd
# ALL NOT SIGNIFICANT: months_employed, current_delinquencies, delinquencies_last7_years, public_records_last10_years, public_records_last12_months, credit_lines_last7_years, installment_balance, real_estate_balance, revolving_balance, real_estate_payment, revolving_available_percent, total_trade_items, satisfactory_accounts, now_delinquent_derog, was_delinquent_derog
```
```{r}
listings_lm = subset(listings_lm, select = -c(income_range, income_range_description, months_employed, current_delinquencies, delinquencies_last7_years, public_records_last10_years, public_records_last12_months, credit_lines_last7_years, installment_balance, real_estate_balance, revolving_balance, real_estate_payment, revolving_available_percent, total_trade_items, satisfactory_accounts, now_delinquent_derog, was_delinquent_derog))

linear2 <- lm(borrower_rate ~ ., data=listings_lm)
summary(linear2)

# ALL NOT SIGNIFICANT: stated_monthly_income, current_credit_lines, delinquencies_over60_days, delinquencies_over90_days
```

```{r}
listings_lm = subset(listings_lm, select = -c(stated_monthly_income, current_credit_lines, delinquencies_over60_days, delinquencies_over90_days))
linear3 <- lm(borrower_rate ~ ., data=listings_lm)
summary(linear3)

# Not all factors of scorex, employment_status_description are significant
# income_verifiable, dti_wprosper_loan are only significant at p-value < 0.1
```

## Logistic Regression

A logistic model of what factors lead to a loan default. Essentially we want to check our understanding from the last model. All the items that the last model showed as credit risks leading to compensatory adjustment in interest rate - do those items really cause defaults. Are there other items which cause default but which does not show in Model 1?

```{r}
# we gotta solve for loan_status, but I bet we gotta change this column to default (1) or not (0)
# even though there are four options (defaulted, chargeoff, completed, current)
# From the internet: The term "charge off" means that the original creditor has given up on being repaid according to the original terms of the loan. It considers the remaining balance to be bad debt, but that doesn't mean you no longer owe the amount that has not been repaid.

listings_glm <- listings
listings_glm <- subset(listings_glm, loan_status_description != "CURRENT") #Removed loans still pending


listings_glm$loan_status_description <- ifelse(listings_glm$loan_status_description == "COMPLETED", 0, 1) #assigned 1 if loan defaulted or chargedback, 0 if completed
```

```{r}
log_m1 <- glm(loan_status_description ~ ., data= listings_glm)
summary(log_m1)
#ALL NOT SIGNIFICANT: number_of_days, amount_funded, borrower_rate, listing_monthly_payment, scorex, listing_category_id, income_verifiable, income_range, income_range_description, stated_monthly_income, dti_wprosper_loan, months_employed, lender_indicator, current_delinquencies, delinquencies_last7_years, public_records_last10_years, credit_lines_last7_years, inquiries_last6_months, amount_delinquent, current_credit_lines, open_credit_lines, bankcard_utilization, installment_balance, real_estate_balance, revolving_balance, real_estate_payment, total_inquiries, satisfactory_accounts, was_delinquent_derog, delinquencies_over30_days, delinquencies_over60_days, is_homeowner
```
```{r}
#removing insignificant variables 
listings_glm = subset(listings_glm, select = -c(number_of_days, amount_funded, borrower_rate, listing_monthly_payment, scorex, listing_category_id, income_verifiable, income_range, income_range_description, stated_monthly_income, dti_wprosper_loan, months_employed, lender_indicator, current_delinquencies, delinquencies_last7_years, public_records_last10_years, credit_lines_last7_years, inquiries_last6_months, amount_delinquent, current_credit_lines, open_credit_lines, bankcard_utilization, installment_balance, real_estate_balance, revolving_balance, real_estate_payment, total_inquiries, satisfactory_accounts, was_delinquent_derog, delinquencies_over30_days, delinquencies_over60_days, is_homeowner))

```

```{r}
log_m2 <- glm(loan_status_description ~., data = listings_glm)
summary(log_m2)
#ALL NOT SIGNIFICANT: monthly_debt, revolving_available_percent, now_delinquent_derog, delinquencies_over90_days
```

```{r}
#removing insignificant variables 
listings_glm = subset(listings_glm, select = -c(monthly_debt, revolving_available_percent, now_delinquent_derog, delinquencies_over90_days))
```

```{r}
log_m3 <- glm(loan_status_description~ ., data = listings_glm)
summary(log_m3)
```






















